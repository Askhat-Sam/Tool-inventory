<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool management system</title>
    <style>
        body {
          height: 100vh;
          /* display: flex; */
          align-items: center;
          background: linear-gradient(to top left, #28b487, #7dd56f);
        }
        h1 {
          font-family: sans-serif;
          font-size: 25px;
          line-height: 1;
          width: 100%;
          padding: 0px;
          text-align: center;
          color: white;
        }
        .nav-block {
          /* background-color: antiquewhite; */
          width: auto;
          display: flex;
          /* flex-direction: column; */
        }
        .nav-component{
          /* width: auto; */
          display: flex;
          flex-direction: column;
          row-gap: 5px;
        }
        nav{
          display: flex;
          flex-direction: row;
          column-gap: 10px
        }
        table{
          background-color: white;
          margin-top: 10px;
          width: 100%;
        }
        table, tr, th, td {
          border: 1px solid rgb(117, 116, 116);
          border-collapse: collapse;
          font-family: sans-serif;
          font-size: 12px;
        }
        th {
          background-color: rgb(203, 207, 207);
          text-align: left;
        }
        .center {
          margin-left: auto;
          margin-right: auto;
        }
        tr:hover{
          background-color: rgb(173, 241, 253);
        }
        .text {
          padding: 0px;
          margin: 1px 10px;
        };
        form {
          display: table;
        };
        p {
          display: table-row;
        
        };
        label {
          display: table-cell;
        };
        input {
          display: table-cell;
        };
        select {
          display: table-cell;
        }
        .text-element{
          margin: 5px;
        }
        .information-block{
          background-color: bisque;
        }
        .tool-issue-block{
          background-color: rgb(199, 138, 64);
        }
        fieldset {
            border: 2px solid #0000005e;
            margin: 0 50px 0 50px;
        }
        legend {
            padding: 0 20px;
            color: #000000;
        }
      </style>
</head>
<body>
    <!-- <h1>Tool management system</h1> -->

    <nav >
      <div class="nav-block search-block center">
        <fieldset>
            <legend>Search</legend>
            <form >
                <p class="text-element">
                  <select name="type" id="search-filter-1">
                    <option value="Row" selected="selected">Row</option>
                    <option value="Location">Location</option>
                    <option value="Barcode">Barcode</option>
                    <option value="Parent barcode">Parent barcode</option>
                    <option value="Item name">Item name</option>
                    <option value="Part number">Part number</option>
                    <option value="Serial number">Serial number</option>
                    <option value="Calibration due date">Calibration due date</option>
                    <option value="Status">Status</option>
                  </select>
                  <input type="text" id="search-filter-1-text" name="lname">
                </p>
                <p class="text-element">
                    <select name="type" id="search-filter-2">
                        <option value="Row" selected="selected">Row</option>
                        <option value="Location">Location</option>
                        <option value="Barcode">Barcode</option>
                        <option value="Parent barcode">Parent barcode</option>
                        <option value="Item name">Item name</option>
                        <option value="Part number">Part number</option>
                        <option value="Serial number">Serial number</option>
                        <option value="Calibration due date">Calibration due date</option>
                        <option value="Status">Status</option>
                      </select>
                  <input type="text" id="search-filter-2-text" name="lname">
                </p>
                <p class="text-element">
                    <select name="type" id="search-filter-3">
                        <option value="Row" selected="selected">Row</option>
                        <option value="Location">Location</option>
                        <option value="Barcode">Barcode</option>
                        <option value="Parent barcode">Parent barcode</option>
                        <option value="Item name">Item name</option>
                        <option value="Part number">Part number</option>
                        <option value="Serial number">Serial number</option>
                        <option value="Calibration due date">Calibration due date</option>
                        <option value="Status">Status</option>
                      </select>
                  <input type="text" id="search-filter-3-text" name="lname">
                </p>
                <p class="text-element">
                    <select name="type" id="search-filter-4">
                        <option value="Row" selected="selected">Row</option>
                        <option value="Location">Location</option>
                        <option value="Barcode">Barcode</option>
                        <option value="Parent barcode">Parent barcode</option>
                        <option value="Item name">Item name</option>
                        <option value="Part number">Part number</option>
                        <option value="Serial number">Serial number</option>
                        <option value="Calibration due date">Calibration due date</option>
                        <option value="Status">Status</option>
                      </select>
                  <input type="text" id="search-filter-4-text" name="lname">
                </p>
                <p class="text-element">
                    <select name="type" id="search-filter-5">
                        <option value="Row" selected="selected">Row</option>
                        <option value="Location">Location</option>
                        <option value="Barcode">Barcode</option>
                        <option value="Parent barcode">Parent barcode</option>
                        <option value="Item name">Item name</option>
                        <option value="Part number">Part number</option>
                        <option value="Serial number">Serial number</option>
                        <option value="Calibration due date">Calibration due date</option>
                        <option value="Status">Status</option>
                      </select>
                  <input type="text" id="search-filter-5-text" name="lname">
                </p>
                <button class="btn-search">Search</button>
              </form>
        </fieldset>

        <fieldset>
            <legend>Additional infomation</legend>
        </fieldset>
    </nav>

    <div class="container">
    
      <table class="center">
        <tr>
          <th>Row</th>
          <th>Location</th>
          <th>Barcode</th>
          <th>Parent barcode</th>
          <th>Item name</th>
          <th>Part number</th>
          <th>Serial number</th>
          <th>Calibration due date</th>
          <th>Status</th>
        </tr>

        <tbody id="myTable">

        </tbody>
       
      </table>
    </div>
    
    

  </body>
  <script type="module">

    const searchFilterOne=document.getElementById("search-filter-1").value;
    const searchFilterTwo=document.getElementById("search-filter-2").value;
    const searchFilterThree=document.getElementById("search-filter-3").value;
    const searchFilterFour=document.getElementById("search-filter-4").value;
    const searchFilterFive=document.getElementById("search-filter-5").value;
    const searchFilterOneText=document.getElementById("search-filter-1-text").value;
    const searchFilterTwoText=document.getElementById("search-filter-2-text").value;
    const searchFilterThreeText=document.getElementById("search-filter-3-text").value;
    const searchFilterFourText=document.getElementById("search-filter-4-text").value;
    const searchFilterFiveTExt=document.getElementById("search-filter-5-text").value;
    const btnSearch=document.querySelector(".btn-search");
    
    
    
    btnSearch.addEventListener('click', function(e){
      e.preventDefault()
      const searchFilterOne=document.getElementById("search-filter-1").value;
      const searchFilterOneText=document.getElementById("search-filter-1-text").value;
      document.getElementById('myTable').innerHTML=""
      loadData(searchFilterOne, searchFilterOneText)
    })
    
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    
    const supabaseUrl = 'https://aevibblwimzhlpidnbnn.supabase.co'
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFldmliYmx3aW16aGxwaWRuYm5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzY3ODIzNzYsImV4cCI6MTk5MjM1ODM3Nn0.mT7nMMcTkYMemGYzLK79JB2qhUxPVF8k_qFzsqYhfJI"
    const supabase = createClient(supabaseUrl, supabaseKey);
    
    
          let data;
          
          async function loadData() {
          const searchFilterOne=document.getElementById("search-filter-1").value;
          const searchFilterOneText=document.getElementById("search-filter-1-text").value;
          const searchFilterTwo=document.getElementById("search-filter-2").value;
          const searchFilterTwoText=document.getElementById("search-filter-2-text").value;
      
          const res= await fetch('https://aevibblwimzhlpidnbnn.supabase.co/rest/v1/toolDB',{
            headers: {
              apikey:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFldmliYmx3aW16aGxwaWRuYm5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzY3ODIzNzYsImV4cCI6MTk5MjM1ODM3Nn0.mT7nMMcTkYMemGYzLK79JB2qhUxPVF8k_qFzsqYhfJI',
              authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFldmliYmx3aW16aGxwaWRuYm5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzY3ODIzNzYsImV4cCI6MTk5MjM1ODM3Nn0.mT7nMMcTkYMemGYzLK79JB2qhUxPVF8k_qFzsqYhfJI'
            } 
          });
          let query = supabase
            .from('toolDB')
            .select('*')
          
            query=searchFilterOneText ? query.eq(searchFilterOne, searchFilterOneText) : query
            console.log(query);
            // query=query + searchFilterOneText ? `.like('Status',${searchFilterOneText})`:`.like('Status','%Broken%')`
            // query=query.like(searchFilterOne,`%${searchFilterOneText}%`).like(searchFilterTwo,`%${searchFilterTwoText?searchFilterTwoText:undefined}%`)

            console.log(searchFilterOne,searchFilterOneText,searchFilterTwo,searchFilterTwoText);
    
     
        //     // query=query.and(`${searchFilterOne}.like.%${searchFilterOneText}%, ${searchFilterTwo}.like.%${searchFilterTwoText?searchFilterTwoText:undefined}%`)}
    
          const { data, error } = await query
            buildTable(data)
    
       
         }
    
         loadData();
    
          //build table
          function buildTable(data){
            let table=document.getElementById('myTable')
            console.log(`The results found: ${data.length}`);
            for (let i=0; i<data.length; i++){
              let row=`<tr>
                          <td>${data[i].Row}</td>
                          <td>${data[i].Location}</td>
                          <td>${data[i].Barcode}</td>
                          <td>${data[i].Parent_barcode}</td>
                          <td>${data[i].Item_name}</td>
                          <td>${data[i].Part_number}</td>
                          <td>${data[i].Serial_number}</td>
                          <td>${data[i].Calibration_due_date}</td>
                          <td>${data[i].Status}</td>
                      </tr>`
    
                      // console.log(row);
              table.innerHTML+=row
            }
    
          }
        </script>
    
</html>